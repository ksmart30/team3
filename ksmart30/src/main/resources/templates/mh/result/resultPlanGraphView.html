<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="layout/main">
<th:block layout:fragment="customHead">
	<th:block th:include="layout/customHead"></th:block>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>M/H 계획/실적(그래프)</title>	
	<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
	<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.bundle.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.bundle.min.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
	<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<!-- 리스트뿌려주기 -->
	<head>
<script>

function searchResult(crt_date, end_date){
	
	console.log("날짜별 검색 시작");	
	$.ajax({
		url:'/manHour/manHourResultGraphSearchView',
		data:{crt_date:crt_date,end_date:end_date},	
	});	
};

$(document).ready(function() {	
	
	$('#btn-search').click(function(){		
		var crt_date_format = $('#crt_date').val();
		var end_date_format = $('#end_date').val();
		
		var crt_date = crt_date_format.substr(0,4)+crt_date_format.substr(5,2)+crt_date_format.substr(8,2);
		var end_date = end_date_format.substr(0,4)+end_date_format.substr(5,2)+end_date_format.substr(8,2);
		
		console.log(crt_date+"날짜야 나오니?"+end_date);
		searchResult(crt_date,end_date);		
	});
	
		init_charts();
		console.log('프로젝트 리스트 출력');

		function init_charts() {
			console.log('run_charts  typeof [' + typeof (Chart)
					+ ']');
			if (typeof (Chart) === 'undefined') {
				return;
			}
			console.log('init_charts');
			Chart.defaults.global.legend = {
				enabled : false
			};
			
		//차트호출 함수시작
		function barchart() {
			//리턴하기 위한 변수 선언
			var result;
			
			$("#list_table tr").click(function() {//문자열 저장할 변수 선언		
				var str = ""
				//배열선언
				var tdArr = new Array();
				//현재 클릭된 행<tr>
				var tr = $(this);
				var td = tr.children();
				console.log("row : "+ tr.text());
				//선택한 행의 색을 바꿔주기 위한 것
				$("#list_table tr").css("background-color", "#ffffff");
				$(this).css( "background-color", "#f4f4f4" );
				//선택한 행중에서 인덱스 번호가 2인 값을 가져옴 (pjt_cd)
				var pjt_cd = td.eq(2).text();
				console.log("pjt_cd : "+ pjt_cd);	
				
				$.ajax({
						url : '/manHour/manHourResultGraph',
						type : 'GET',
						dataType : "json",
						async:false,
						data : {pjt_cd : pjt_cd},
						//ajax 배열 값을 전역변수로 선언
						success : function(data) {
							//테이블의 행 클릭시 해당하는 값 출력
							$('#chart').empty();
							$(data).each(function(index,item) { //each = foreach (반복문)
									a = item.plan_A;
									b = item.plan_B;
									c = item.plan_C;
									d = item.plan_D;
									e = item.plan_E;
									f = item.plan_F;
									g = item.plan_G;
									$('#chart').append('<tr>');
									$('#chart').append('<td>'+ a+ '</td>');
									$('#chart').append('<td>'+ b+ '</td>');
									$('#chart').append('<td>'+ c+ '</td>');
									$('#chart').append('<td>'+ d+ '</td>');
									$('#chart').append('<td>'+ e+ '</td>');
									$('#chart').append('<td>'+ f+ '</td>');
									$('#chart').append('<td>'+ g+ '</td>');
									$('#chart').append('</tr>');
									console.log("A : "+ a+ " B : "+ b+ " C : "+ c+" D : "+ d+ " E: "+ e+ " F : "+ f+ " G : "+ g);
			
						});
							
					}
									
				});								
				//실적 그래프 값 가져오기 시작!
				$.ajax({
					url:'/manHour/manHourResultGraph2',
					type:'GET',
					dataType : "json",
					data : {pjt_cd : pjt_cd},
					success : function(data) {
						console.log("실적그래프 값들 출력");
						console.log(data);						
						$(data).each(function(index,item){
							console.log("work_time : "+item.work_TIME +"    work_STEP :  "+item.work_STEP);		
						
							$('#chart2').empty();
							$('#chart2').append('<tr>');
							$('#chart2').append('<td>'+ item.work_STEP+ '</td>');	
							$('#chart2').append('<td>'+ item.work_TIME+ '</td>');										
							$('#chart2').append('</tr>');	
							
							if(item.work_STEP !='A' || item.work_STEP !='B' || item.work_STEP !='C' ||item.work_STEP !='D' || item.work_STEP !='E' || item.work_STEP !='F' ||item.work_STEP !='G'){
								time_a = 0;
								time_b = 0;
								time_c = 0;
								time_d = 0;
								time_e = 0;
								time_f = 0;
								time_g = 0;
								time_z = 0;									
							}									
							if(item.work_STEP =='B'){
								time_b = item.work_TIME;	
								console.log("time_b : "+time_b);
								
							}
							if(item.work_STEP =='C'){
								time_c = item.work_TIME;
								console.log("time_c : "+time_c);
								
							}
							if(item.work_STEP =='D'){
								time_d = item.work_TIME;
								console.log("time_d : "+time_d);
								
							}
							if(item.work_STEP =='E'){
								time_e = item.work_TIME;
								console.log("time_e : "+time_e);
								
							}
							if(item.work_STEP =='F'){
								time_f = item.work_TIME;
								console.log("time_f : "+time_f);
								
							}
							if(item.work_STEP =='G'){
								time_g = item.work_TIME;
								console.log("time_g : "+time_g);
								
							}
							if(item.work_STEP =='Z'){
								time_z = item.work_TIME;
								console.log("time_z : "+time_z);
								return false;
							}		
						});							
					}					
				});
						
				 console.log(time_a +" / "+time_b+" / "+time_c+" / "+time_d+" / "+time_e+" / "+time_f+" / "+time_g); 
				
				//실적 그래프 값 가져오기 끝!			
				

				//차트를 넣어보자 시작
				
				var ctx = document.getElementById("mybarChart3");
				var mybarChart = new Chart(ctx,{
						
						type : 'bar',
						data : {
						labels : [ "기획", "심의", "허가","착공", "실시", "A/S", "준공" ], //X축의 제목
						datasets : [{			
								backgroundColor : "#3366FF",
								data : [ a, b, c, d, e, f, g ]},{ // 변수들->AJAX 실행 후 호출된 값
								//label : '# of Votes',
								backgroundColor : "#FF0000",
								data : [time_a,time_b,time_c,time_d,time_f,time_g]}
								]},
									options : {
										scales : {
											yAxes : [ {
												ticks : {
													beginAtZero : true //Y축의 값이 0부터 시작
												}
											} ]
										}
									}
								});
				
			
				//차트를 넣어보자 끝
			});
			//여기?		
		}
		//차트호출 함수끝!
				
		var ccc = barchart();
		
	}
		
});
</script>


	</head>
</th:block>
<th:block layout:fragment="customBody">
	<font color="black">

	<div class="page-title">
				<div class="title_left">
					
					<h2><b>M/H 계획,실적(그래프)</b></h2>
					<h5><font color="gray"><b>5.M/H 실적관리&nbsp;>&nbsp;&nbsp;5.2프로젝트진행관리</b></font></h5>
					
				</div>
			</div>
		<div class="x_content" style="text-align: right">
				<div class="btn-group" >
					<button class="btn btn-default" type="reset">입력</button>
					<button class="btn btn-default" type="button">수정</button>
					<button class="btn btn-default" type="button">삭제</button>
					<button class="btn btn-default" type="button">저장</button>
					<button class="btn btn-default" type="button">출력</button>
						</div>
			
				</div>
	
	<div class="x_panel">
				
		<div class="x_content">

			<div class="col-md-12 col-sm-6 col-xs-12" style="width: 100%">
				<div class="x_panel">
					<br>
					<div class="x_content">
						<form action="/manHour/manHourResultGraphSearchView">
							<table class="table table-bordered">
								<thead>
									<tr style="font-size: 15px">
										<th>◎검색조건 &emsp;</th>
										<th>시작년월 &emsp;&emsp;&emsp; 
										<input type="date" name="crt_date" id="crt_date"> &emsp;&emsp;										
										</th>
										<th>마감년월 &emsp;&emsp;&emsp; 
										<input type="date" name="end_date" id="end_date"> &emsp;&emsp;										
											<button id="btn-search" class="btn" style="color:black">검색</button>
										</th>
									</tr>									
								</thead>
							</table>
						</form>
					</div>
				</div>
			</div>

			<div class="col-md-3 col-sm-6 col-xs-12" style="width: 55%">
				<div class="x_panel">
					<div class="x_title">

						<div class="clearfix"></div>
					</div>
					<div class="x_content">

						<div class="table-responsive">
							<div style="overflow: scroll; width: 100%; height: 650px; padding: 10px; background-color:;">
								<table class="table jambo_table bulk_action">
									<thead>
										<tr class="headings">
											<th class="column-title">PM</th>
											<th class="column-title">담당부서</th>
											<th class="column-title">프로젝트코드</th>
											<th class="column-title">프로젝트</th>
											<th class="column-title">시작일</th>
											<th class="column-title">종료일</th>
										</tr>
									</thead>
									<tbody  id="list_table" style="font-size: 14px; line-height: 25px">
										<!-- 화면에 뿌려줄 것! -->
										<tr th:each="g : ${graphList}">
											<td th:text="${g.KOR_NM}"></td>
											<td th:text="${g.DEPT_NM}"></td>
											<td th:text="${g.PJT_CD}"></td>
											<td th:text="${g.SVC}"></td>
											<td th:text="${g.CRT_DATE}"></td>
											<td th:text="${g.END_DATE}"></td>
										</tr>
									</tbody>
							
									<!-- 차트에 뿌릴 데이터 테이블에 연습 시작 -->
								</table>

								<!-- 차트에 뿌릴 데이터 테이블에 연습 끝!-->



								<br> <br> <br> <br> <br> <br> <br>
								<br> <br> <br> <br> <br> <br> <br>
								<br> <br> <br> <br> <br> <br> <br>
								<br> <br> <br>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="col-md-9 col-sm-6 col-xs-12" style="width: 45%">
				<div class="x_panel">
					<!-- 안에 넣어라 -->
					<!-- 추가 입력할 정보 창 -->
					<form>
						<div class="col-md-12 col-sm-13 col-xs-12">
							
								<div class="x_content">
									<div class="clearfix">
										<h4>그래프</h4>
									
									</div>
								</div>

								<!-- start of user-activity-graph -->
								<div id="graph_bar" style="width: 100%; height: 60px;"></div>
								<!-- end of user-activity-graph -->

								<div class="" data-example-id="togglable-tabs">
									<ul id="myTab" class="nav nav-tabs bar_tabs" role="tablist">
										<li role="presentation" class="active"><a href="#tab_content1" id="home-tab" role="tab" data-toggle="tab" aria-expanded="true">설계1</a></li>
										<li role="presentation" class=""><a href="#tab_content2" role="tab" id="profile-tab" data-toggle="tab" aria-expanded="false">설계2</a></li>
										<li role="presentation" class=""><a href="#tab_content3" role="tab" id="profile-tab2" data-toggle="tab" aria-expanded="false">PD전략부</a></li>
										<li role="presentation" class=""><a href="#tab_content4" role="tab" id="profile-tab4" data-toggle="tab" aria-expanded="false">설계지원</a></li>
									</ul>


									<div id="myTabContent" class="tab-content">
										<!-- 학력사항 -->
										<div role="tabpanel" class="tab-pane fade active in" id="tab_content1" aria-labelledby="home-tab">
											<div class="col-md-12 col-sm-6 col-xs-12">
												<div class="x_panel">	

													<!-- 차트 연습 시작 -->
													<table>
														<div class="col-md-12 col-sm-12 col-xs-20">
															<div class="x_panel">
																<div class="x_title">
																	<h2>
																		Bar graph <small>MH 계획/실적 그래프 (계획:파 실적:빨)</small>
																		
																		
																	</h2>
																	
																	<div class="clearfix"></div>
																</div>
																<div class="x_content">
																	<canvas id="mybarChart3" width="20" height="10"></canvas>
																</div>

															</div>
														</div>

													</table>



													<!-- 차트 연습 끝 -->
													<table class="table table-striped jambo_table bulk_action">
														<thead>
															<tr class="headings">
																<th class="column-title">기획</th>
																<th class="column-title">심의</th>
																<th class="column-title">허가</th>
																<th class="column-title">착공</th>
																<th class="column-title">실시</th>
																<th class="column-title">A/S</th>
																<th class="column-title">준공</th>
															</tr>
														</thead>

														<tbody id="chart" style="font-size: 14px; line-height: 25px">
														</tbody>
													</table>
													
													
														<table class="table table-striped jambo_table bulk_action">
														<thead>
															<tr class="headings">
																<th class="column-title">단계</th>
																<th class="column-title">시간</th>
																														
															</tr>
														</thead>

														<tbody id="chart2" style="font-size: 14px; line-height: 25px">


														</tbody>
													</table>						
												</div>
											</div>
										</div>


										<!-- 가족사항 -->
										<div role="tabpanel" class="tab-pane fade in" id="tab_content2" aria-labelledby="tab">
											<div class="col-md-12 col-sm-6 col-xs-12">
												<div class="x_panel">
													<div class="x_title">
														<h4>설계2</h4>
													</div>
													<div class="clearfix"></div>
													<div class="x_content" style="text-align: right">
														<button type="button" class="btn btn-round btn-primary">입력</button>
														<button type="button" class="btn btn-round btn-primary">저장</button>
													</div>
													<table class="table table-bordered">
														<thead>
															<tr>
																<th>NO</th>
																<th>관계</th>
																<th>성명</th>
																<th>직업</th>
																<th>소재지(시/도)</th>
															</tr>
														</thead>
														<tbody>
															<tr>
																<th>1</th>
																<td>배우자</td>
																<td>김**</td>
																<td>전업주부</td>
															</tr>
															<tr>
																<th>2</th>
																<td>자녀</td>
																<td>김**</td>
																<td>자영업</td>
															</tr>
														</tbody>
													</table>



												</div>
											</div>
										</div>

										<!-- 자격,면허사항 -->
										<div role="tabpanel" class="tab-pane fade in" id="tab_content3" aria-labelledby="tab">
											<div class="col-md-12 col-sm-6 col-xs-12">
												<div class="x_panel">
													<div class="x_title">
														<h4>PD전략부</h4>
													</div>
													<div class="clearfix"></div>
													<div class="x_content" style="text-align: right">
														<button type="button" class="btn btn-round btn-primary">입력</button>
														<button type="button" class="btn btn-round btn-primary">저장</button>
													</div>
													<table class="table table-bordered">
														<thead>
															<tr>
																<th>NO</th>
																<th>자격증</th>
																<th>Last Name</th>
																<th>Username</th>
															</tr>
														</thead>
														<tbody>
															<tr>
																<th scope="row">1</th>
																<td>Mark</td>
																<td>Otto</td>
																<td>@mdo</td>
															</tr>
															<tr>
																<th scope="row">2</th>
																<td>Jacob</td>
																<td>Thornton</td>
																<td>@fat</td>
															</tr>
														</tbody>
													</table>



												</div>
											</div>
										</div>


										<!-- 외국어사항 -->
										<div role="tabpanel" class="tab-pane fade in" id="tab_content4" aria-labelledby="tab">
											<div class="col-md-12 col-sm-6 col-xs-12">
												<div class="x_panel">
													<div class="x_title">
														<h4>외국어</h4>
													</div>
													<div class="clearfix"></div>
													<div class="x_content" style="text-align: right">
														<button type="button" class="btn btn-round btn-primary">입력</button>
														<button type="button" class="btn btn-round btn-primary">저장</button>
													</div>
													<table class="table table-bordered">
														<thead>
															<tr>
																<th>NO</th>
																<th>외국어</th>
																<th>Last Name</th>
																<th>Username</th>
															</tr>
														</thead>
														<tbody>
															<tr>
																<th scope="row">1</th>
																<td>Mark</td>
																<td>Otto</td>
																<td>@mdo</td>
															</tr>
															<tr>
																<th scope="row">2</th>
																<td>Jacob</td>
																<td>Thornton</td>
																<td>@fat</td>
															</tr>
														</tbody>
													</table>

												</div>
											</div>
										</div>
									</div>
								</div>
							
						</div>
					</form>


					<div class="clearfix"></div>
				</div>
			</div>
		</div>
		</div>
	</font>
		
</th:block>
<th:block layout:fragment="customJquery">



</th:block>

<th:block layout:fragment="customJquery">
	<th:block th:include="layout/customJquery"></th:block>
</th:block>
</html>